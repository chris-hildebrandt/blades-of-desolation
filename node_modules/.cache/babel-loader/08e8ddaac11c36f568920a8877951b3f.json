{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-e42a6c50\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"container\"\n};\nconst _hoisted_2 = [\"id\"];\nconst _hoisted_3 = {\n  key: 0\n};\nconst _hoisted_4 = {\n  key: 1\n};\nconst _hoisted_5 = {\n  key: 0\n};\nconst _hoisted_6 = {\n  class: \"row justify-content-center h-50 bg-img\"\n};\nconst _hoisted_7 = {\n  key: 0\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_LootMonster = _resolveComponent(\"LootMonster\");\n\n  const _component_EnemyMonster = _resolveComponent(\"EnemyMonster\");\n\n  const _component_CombatCharacter = _resolveComponent(\"CombatCharacter\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", {\n    class: \"row justify-content-center align-items-center h-50 bg-battle-img\",\n    style: _normalizeStyle('background-image: url(' + _ctx.bgImg + ')')\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.monsters, monster => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      class: \"col-4 col-md-2\",\n      key: monster.id\n    }, [_createElementVNode(\"div\", {\n      class: \"position-absolute hit\",\n      id: 'hit' + monster.id\n    }, null, 8\n    /* PROPS */\n    , _hoisted_2), _ctx.monstersWithHp < 1 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createVNode(_component_LootMonster, {\n      monster: monster\n    }, null, 8\n    /* PROPS */\n    , [\"monster\"])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createVNode(_component_EnemyMonster, {\n      monster: monster\n    }, null, 8\n    /* PROPS */\n    , [\"monster\"])]))]);\n  }), 128\n  /* KEYED_FRAGMENT */\n  )), _ctx.monstersWithHp < 1 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"button\", {\n    class: \"btn btn-warning\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.adventureOn && $options.adventureOn(...args))\n  }, \"Adventure On!\")])) : _createCommentVNode(\"v-if\", true)], 4\n  /* STYLE */\n  ), _createElementVNode(\"div\", _hoisted_6, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.characters, character => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      class: \"col-4 col-md-2\",\n      key: character.id\n    }, [character.inBattle ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [_createVNode(_component_CombatCharacter, {\n      character: character\n    }, null, 8\n    /* PROPS */\n    , [\"character\"])])) : _createCommentVNode(\"v-if\", true)]);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))])]);\n}","map":{"version":3,"mappings":";;;;;AACOA,OAAK,EAAC;;;;;;;;;;;;;AAeJA,OAAK,EAAC;;;;;;;;;;;;uBAfbC,oBAsBM,KAtBN,cAsBM,CArBJC,oBAaM,KAbN,EAaM;AAbDF,SAAK,EAAC,kEAaL;AAbyEG,SAAK,6CAA2BC,UAA3B,GAAgC,GAAhC;AAa9E,GAbN,sBACEH,oBAQMI,SARN,EAQM,IARN,EAQMC,YARwCF,aAQxC,EAR6BG,OAAmB,IAAZ;yBAA1CN,oBAQM,KARN,EAQM;AARDD,WAAK,EAAC,gBAQL;AARmDQ,SAAG,EAAED,OAAO,CAACE;AAQhE,KARN,GACEP,oBAAgE,KAAhE,EAAgE;AAA3DF,WAAK,EAAC,uBAAqD;AAA5BS,QAAE,UAAQF,OAAO,CAACE;AAAU,KAAhE;;AAAA,mBACWL,sBAAc,mBAAzBH,oBAEM,KAFN,EAEMS,UAFN,EAEM,CADJC,aAAkCC,sBAAlC,EAAkC;AAApBL,aAAO,EAAEA;AAAW,KAAlC,EAA8B,IAA9B,EAA8B;AAAA;AAA9B,MAA8B,WAA9B,CACI,CAFN,oBAGAN,oBAEM,KAFN,EAEMY,UAFN,EAEM,CADJF,aAAmCG,uBAAnC,EAAmC;AAApBP,aAAO,EAAEA;AAAW,KAAnC,EAA+B,IAA/B,EAA+B;AAAA;AAA/B,MAA+B,WAA/B,CACI,CAFN,GALF;GAQM,CARN;;AAAA,MASWH,sBAAc,mBAAzBH,oBAEM,KAFN,EAEMc,UAFN,EAEM,CADJb,oBAA2E,QAA3E,EAA2E;AAAnEF,SAAK,EAAC,iBAA6D;AAA1CgB,WAAK,yCAAEC,qDAAF;AAAqC,GAA3E,EAAqD,eAArD,CACI,CAFN,uCAVF;;AAAA,GAqBI,EAPJf,oBAMM,KANN,cAMM,oBALJD,oBAIMI,SAJN,EAIM,IAJN,EAIMC,YAJ0CF,eAI1C,EAJ6Bc,SAAuB,IAAd;yBAA5CjB,oBAIM,KAJN,EAIM;AAJDD,WAAK,EAAC,gBAIL;AAJuDQ,SAAG,EAAEU,SAAS,CAACT;AAItE,KAJN,GACaS,SAAS,CAACC,0BAArBlB,oBAEM,KAFN,EAEMmB,UAFN,EAEM,CADJT,aAA0CU,0BAA1C,EAA0C;AAAxBH,eAAS,EAAEA;AAAa,KAA1C,EAAsC,IAAtC,EAAsC;AAAA;AAAtC,MAAsC,aAAtC,CACI,CAFN,uCADF;GAIM,CAJN;;AAAA,GAKI,EANN,CAOI,CAtBN","names":["class","_createElementBlock","_createElementVNode","style","_ctx","_Fragment","_renderList","monster","key","id","_hoisted_3","_createVNode","_component_LootMonster","_hoisted_4","_component_EnemyMonster","_hoisted_5","onClick","$options","character","inBattle","_hoisted_7","_component_CombatCharacter"],"sourceRoot":"","sources":["C:\\Users\\dhild\\source\\mini-projects\\blades-of-desolation\\src\\views\\BattleField.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <div class=\"row justify-content-center align-items-center h-50 bg-battle-img\" :style=\"'background-image: url('+bgImg+')'\">\r\n      <div class=\"col-4 col-md-2\" v-for=\"monster in monsters\" :key=\"monster.id\">\r\n        <div class=\"position-absolute hit\" :id=\"'hit'+monster.id\"></div>\r\n        <div v-if=\"monstersWithHp < 1\">\r\n          <LootMonster :monster=\"monster\" />\r\n        </div>\r\n        <div v-else>\r\n          <EnemyMonster :monster=\"monster\" />\r\n        </div>\r\n      </div>\r\n      <div v-if=\"monstersWithHp < 1\">\r\n        <button class=\"btn btn-warning\" @click=\"adventureOn\">Adventure On!</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"row justify-content-center h-50 bg-img\" >\r\n      <div class=\"col-4 col-md-2\" v-for=\"character in characters\" :key=\"character.id\">\r\n        <div v-if=\"character.inBattle\">\r\n          <CombatCharacter :character=\"character\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport EnemyMonster from '@/components/Monster'\r\nimport CombatCharacter from '@/components/CombatCharacter'\r\nimport LootMonster from '@/components/LootMonster'\r\nimport { reactive } from \"@vue/reactivity\"\r\nimport $store from '@/store/index.js'\r\nimport { computed, onMounted } from \"@vue/runtime-core\"\r\nimport { gameService } from \"@/services/GameService\"\r\nimport router from \"@/router\"\r\nimport { characterService } from \"@/services/CharacterService\"\r\nimport { useToast } from \"vue-toastification\"\r\nimport { useRoute } from \"vue-router\"\r\n\r\n\r\nexport default {\r\n  name: 'BattleField',\r\n  components: {\r\n    EnemyMonster, CombatCharacter, LootMonster\r\n  },\r\n  watch: {\r\n    charactersWithActions: function(){\r\n      if(this.charactersWithActions < 1 && this.characters.length > 0){\r\n        characterService.endPhase()\r\n      }\r\n    },\r\n    timer: function(){\r\n      if(this.timer <= 0 && this.monstersWithHp > 0){\r\n        characterService.endPhase()\r\n      }\r\n    },\r\n    charactersWithHp: function(){\r\n      const toast = useToast()\r\n      if(this.characters.length < 1){\r\n        router.push({name: 'MapLocation'})\r\n        toast.success('You fled from battle')\r\n      }else if(this.charactersWithHp < 1){\r\n        router.push({name: 'CharacterForm'})\r\n        toast.error('Your party is dead, revive or start over')\r\n      }\r\n    },\r\n    monstersWithHp: function(){\r\n      const toast = useToast()\r\n      if(this.monstersWithHp < 1 && this.charactersWithHp > 0){\r\n        clearInterval($store.state.timerInterval)\r\n        $store.state.timer = 10000*$store.state.player.characters.length\r\n        gameService.victory()\r\n        toast.success('Victory!')\r\n      }\r\n    }\r\n  },\r\n  setup(){\r\n    onMounted(()=>{\r\n      let route = useRoute()\r\n      gameService.spawnMonsters(route.params.monsterLvl, route.params.numMonsters)\r\n      characterService.enterBattle()\r\n      gameService.setTimer()\r\n    })\r\n    const state = reactive({\r\n      monsters: computed(()=> $store.state.combatMonsters),\r\n      characters: computed(()=> $store.state.player.characters.filter(c => c.inBattle)),\r\n      monstersWithHp: computed(()=> state.monsters.filter(m => m.hp > 0).length),\r\n      charactersWithActions: computed(()=> state.characters.filter(c => c.actions > 0 && c.hp > 0 ).length),\r\n      charactersWithHp: computed(()=> state.characters.filter(c => c.hp > 0).length),\r\n      bgImg: computed(()=> $store.state.locationImgList.find(l => l.includes('lvl'+($store.state.location+1)+'-bg'))),\r\n      timer: computed(()=> $store.state.timer),\r\n    })\r\n    return state\r\n  },\r\n  methods:{\r\n    adventureOn(){\r\n      router.push({name: 'AreaLocation'})\r\n    }\r\n  },\r\n    beforeRouteLeave(){\r\n      const toast = useToast()\r\n      if(this.charactersWithHp > 0){\r\n        if(this.monstersWithHp > 0){\r\n          toast.warning('Can\\'t flee from battle.')\r\n          return false\r\n        }\r\n      }\r\n        this.$store.commit('bringOutYourDead')\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.vh-75{\r\n  height: 75vh;\r\n}\r\n.bg-battle-img{\r\n  background-repeat: no-repeat;\r\n  background-size: cover;\r\n  background-position-y: bottom;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}