{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  class: \"header m-3 border-bottom\"\n};\nconst _hoisted_3 = {\n  class: \"title container\"\n};\nconst _hoisted_4 = {\n  class: \"body container\"\n};\nconst _hoisted_5 = {\n  class: \"row justify-content-center\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"btn-group mb-3\"\n};\nconst _hoisted_7 = [\"disabled\"];\n\nconst _hoisted_8 = /*#__PURE__*/_createElementVNode(\"button\", {\n  type: \"button\",\n  class: \"btn btn-danger dropdown-toggle dropdown-toggle-split\",\n  \"data-toggle\": \"dropdown\",\n  \"aria-haspopup\": \"true\",\n  \"aria-expanded\": \"false\"\n}, [/*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"sr-only\"\n}, \"Toggle Dropdown\")], -1\n/* HOISTED */\n);\n\nconst _hoisted_9 = {\n  class: \"dropdown-menu\"\n};\nconst _hoisted_10 = [\"onClick\"];\n\nconst _hoisted_11 = /*#__PURE__*/_createElementVNode(\"sub\", null, \"(SPACEBAR)\", -1\n/* HOISTED */\n);\n\nconst _hoisted_12 = {\n  class: \"row justify-content-center mt-3\"\n};\nconst _hoisted_13 = {\n  key: 0,\n  class: \"btn-group\"\n};\nconst _hoisted_14 = [\"onClick\", \"disabled\"];\nconst _hoisted_15 = {\n  class: \"row justify-content-center mt-3\"\n};\nconst _hoisted_16 = [\"disabled\"];\nconst _hoisted_17 = [\"disabled\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _ctx.selected ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, _toDisplayString(_ctx.selected.name) + \"(\" + _toDisplayString(_ctx.selected.actions) + \") \", 1\n  /* TEXT */\n  )]), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_ctx.selected.spells.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createElementVNode(\"button\", {\n    id: \"castSpell\",\n    type: \"button\",\n    class: \"btn btn-danger\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.castSpell && $options.castSpell(...args)),\n    disabled: _ctx.selected.actions < 1 || _ctx.selected.magic < 1 && _ctx.selectedSpell.level > 0\n  }, _toDisplayString(_ctx.selectedSpell ? _ctx.selectedSpell.name : $options.selectSpell(_ctx.selected.spells[0])) + \" lvl-\" + _toDisplayString(_ctx.selectedSpell ? _ctx.selectedSpell.level : $options.selectSpell(_ctx.selected.spells[0])), 9\n  /* TEXT, PROPS */\n  , _hoisted_7), _hoisted_8, _createElementVNode(\"div\", _hoisted_9, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.selected.spells, (spell, index) => {\n    return _openBlock(), _createElementBlock(\"button\", {\n      class: \"dropdown-item\",\n      key: spell.id,\n      onClick: $event => $options.selectSpell(index)\n    }, _toDisplayString(spell.name) + \" lvl-\" + _toDisplayString(spell.level), 9\n    /* TEXT, PROPS */\n    , _hoisted_10);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))]), _hoisted_11])) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_12, [_ctx.selected.abilities.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.selected.abilities, ability => {\n    return _openBlock(), _createElementBlock(\"button\", {\n      key: ability.name,\n      type: \"button\",\n      class: \"btn btn-danger\",\n      onClick: $event => {\n        $options.useAbility(ability, _ctx.selected);\n        ability.uses--;\n      },\n      disabled: ability.uses <= 0\n    }, _toDisplayString(ability.name) + \" (\" + _toDisplayString(ability.uses) + \")\", 9\n    /* TEXT, PROPS */\n    , _hoisted_14);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))])) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", _hoisted_15, [_createElementVNode(\"button\", {\n    class: \"btn btn-warning mx-2\",\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.waitAction && $options.waitAction(...args)),\n    disabled: _ctx.selected.actions < 1\n  }, \"Wait\", 8\n  /* PROPS */\n  , _hoisted_16), !_ctx.route.params.boss ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    class: \"btn btn-secondary\",\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.fleeAction && $options.fleeAction(...args)),\n    disabled: _ctx.selected.actions < 1\n  }, \"Flee\", 8\n  /* PROPS */\n  , _hoisted_17)) : _createCommentVNode(\"v-if\", true)])])])) : _createCommentVNode(\"v-if\", true);\n}","map":{"version":3,"mappings":"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","names":["class","_createElementVNode","type","_ctx","_createElementBlock","_hoisted_1","_toDisplayString","name","actions","spells","length","id","onClick","$options","disabled","magic","level","_hoisted_7","_hoisted_8","_Fragment","_renderList","spell","index","key","_hoisted_10","_hoisted_11","abilities","ability","uses","_hoisted_14","_hoisted_16","params","boss","_hoisted_17"],"sourceRoot":"","sources":["C:\\Users\\dhild\\source\\mini-projects\\blades-of-desolation\\src\\components\\BattleOptions.vue"],"sourcesContent":["<template>\r\n  <div v-if=\"selected\">\r\n    <div class=\"header m-3 border-bottom\">\r\n      <div class=\"title container\">\r\n        {{selected.name}}({{selected.actions}})\r\n      </div>\r\n    </div>\r\n    <div class=\"body container\">\r\n      <div class=\"row justify-content-center\">\r\n        <div class=\"btn-group mb-3\" v-if=\"selected.spells.length > 0\">\r\n          <button id=\"castSpell\" type=\"button\" class=\"btn btn-danger\" @click=\"castSpell\" :disabled=\"selected.actions < 1 || (selected.magic < 1 && selectedSpell.level > 0)\">{{selectedSpell ? selectedSpell.name : selectSpell(selected.spells[0])}} lvl-{{selectedSpell ? selectedSpell.level : selectSpell(selected.spells[0])}}</button>\r\n          <button type=\"button\" class=\"btn btn-danger dropdown-toggle dropdown-toggle-split\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\r\n            <span class=\"sr-only\">Toggle Dropdown</span>\r\n          </button>\r\n          <div class=\"dropdown-menu\">\r\n              <button class=\"dropdown-item\" v-for=\"(spell, index) in selected.spells\" :key=\"spell.id\" @click=\"selectSpell(index)\">{{spell.name}} lvl-{{spell.level}}</button>\r\n          </div>\r\n          <sub>(SPACEBAR)</sub>\r\n        </div>\r\n      </div>\r\n      <div class=\"row justify-content-center mt-3\">\r\n        <div class=\"btn-group\" v-if=\"selected.abilities.length > 0\">\r\n          <button v-for=\"ability in selected.abilities\" :key=\"ability.name\" type=\"button\" class=\"btn btn-danger\" @click=\"useAbility(ability, selected); ability.uses--\" :disabled=\"ability.uses <= 0\">{{ability.name}} ({{ability.uses}})</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"row justify-content-center mt-3\">\r\n        <button class=\"btn btn-warning mx-2\" @click=\"waitAction\" :disabled=\"selected.actions < 1\">Wait</button>\r\n        <button class=\"btn btn-secondary\" @click=\"fleeAction\" :disabled=\"selected.actions < 1\" v-if=\"!route.params.boss\">Flee</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { reactive } from \"@vue/reactivity\"\r\nimport { computed, onMounted, watch } from \"@vue/runtime-core\"\r\nimport $store from \"@/store/index\"\r\nimport $ from \"jquery\"\r\nimport { characterService } from \"@/services/CharacterService\"\r\nimport { spellsService } from \"@/services/SpellsService\"\r\nimport { monstersService } from \"@/services/MonstersService\"\r\nimport { abilitiesService } from \"@/services/AbilitiesService\"\r\nimport { useToast } from \"vue-toastification\"\r\nimport { useRoute } from \"vue-router\"\r\n\r\nexport default {\r\n  name: 'BattleOptions',\r\n  setup(){\r\n    onMounted(()=>{\r\n      $(window).on('keypress', function(e){\r\n        if(e.which == 32){\r\n          e.preventDefault();\r\n          $('#castSpell').trigger('click')\r\n        }\r\n      })\r\n    })\r\n    const state = reactive({\r\n      selected: computed(() => $store.state.selected),\r\n      selectedSpellIndex: 0,\r\n      selectedSpell: computed(()=> $store.state.selected.spells[state.selectedSpellIndex]),\r\n      selectedAbility: {name: 'select ability', level: null},\r\n      route: useRoute(),\r\n    })\r\n    watch(()=>([state.selected]), ()=>{\r\n      state.selectedSpellIndex = 0\r\n    })\r\n    return state\r\n  },\r\n  methods: {\r\n    waitAction(){\r\n      this.selected.actions = 0\r\n      characterService.autoSelect()\r\n    },\r\n    fleeAction(){\r\n      if(this.selected.actions > 0){\r\n        this.selected.actions = 0\r\n        characterService.attemptToFlee(this.selected)\r\n        characterService.autoSelect()\r\n      }\r\n    },\r\n    selectSpell(spellIndex){\r\n      this.selectedSpellIndex = spellIndex\r\n    },\r\n    selectAbility(ability){\r\n      this.selectedAbility = ability\r\n    },\r\n    useAbility(ability, selected){\r\n      abilitiesService.useAbility(ability, selected)\r\n    },\r\n    async castSpell(){\r\n      let target = null\r\n      if(this.selected.hp <= 0){return}\r\n      if(!this.selectedSpell.areaEffect){\r\n        $('[id^=hit]').each(function(){\r\n          let id = $(this).prop('id').replace(/[^0-9]+/, '')\r\n          $('#charImg'+id).addClass('selectable')\r\n          $('#monster'+id).addClass('selectable click')\r\n        })\r\n        setTimeout(()=>document.addEventListener('click', this.eventListenerSpell, {once: true, capture: true}), 100)\r\n      }else{\r\n        target = 'enemies'\r\n        this.selected.magic -= this.selectedSpell.level\r\n        this.selected.actions -= this.selectedSpell.speed\r\n        spellsService.castSpell(this.selectedSpell, target)\r\n        characterService.autoSelect()\r\n        return\r\n      }\r\n    },\r\n    eventListenerSpell(event){\r\n      const toast = useToast()\r\n      event.stopImmediatePropagation()\r\n      let target = monstersService.getMonsterById($(event.target).prop('id').replace(/[^0-9]+/, ''))\r\n      if(!target){\r\n        target = characterService.getCharacterById($(event.target).prop('id').replace(/[^0-9]+/, ''))\r\n      }\r\n      $('[id^=hit]').each(function(){\r\n        let id = $(this).prop('id').replace(/[^0-9]+/, '')\r\n        $('#charImg'+id).removeClass('selectable')\r\n        $('#monster'+id).removeClass('selectable click')\r\n      })\r\n      if(!target){\r\n        toast.warning('Cant cast spell without proper target.')\r\n        return\r\n      }\r\n      this.selected.magic -= this.selectedSpell.level\r\n      this.selected.actions -= this.selectedSpell.speed\r\n      spellsService.castSpell(this.selectedSpell, target)\r\n      characterService.autoSelect()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scope>\r\nsub{\r\n  position: absolute;\r\n  left: 50px;\r\n  top: 45px;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}